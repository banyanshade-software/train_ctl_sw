#
# initially derived from low/canton_config.h
#

#  
#  typedef struct canton_config {
#          uint16_t volts_cv[8]; // unit : 1/100 V, from 1000 to 0
#          GPIO_TypeDef *volt_port_b0;
#          GPIO_TypeDef *volt_port_b1;
#          GPIO_TypeDef *volt_port_b2;
#          uint16_t volt_b0;
#          uint16_t volt_b1;
#          uint16_t volt_b2;
#          uint8_t pwm_timer_num; // 1.. index in CantonTimerHandles
#          uint32_t ch0;
#          uint32_t ch1;
#          uint8_t notif_bemf:1;
#          uint8_t reverse_bemf:1;
#  } canton_config_t;
#  

config canton {
  	const uint16_t volts_cv[8]   // unit : 1/100 V, from 1000 to 0
		= (all) { 1000, 770, 621,  538, 451, 413, 379, 355};

	const GPIO_TypeDef *volt_port_b0
		= (main:*) table(vpin_main, p0)
		= (default) NULL;
	const uint16_t volt_b0
		= (main:*) table(vpin_main, b0)
		= (default) 0;

	const GPIO_TypeDef *volt_port_b1
		= (main:*) table(vpin_main, p1)
		= (default) NULL;
	const uint16_t volt_b1
		= (main:*) table(vpin_main, b1)
		= (default) 0;

	const GPIO_TypeDef *volt_port_b2
		= (main:*) table(vpin_main, p2)
		= (default) NULL;
	const uint16_t volt_b2
		= (main:*) table(vpin_main, b2)
		= (default) 0;

    const  uint8_t pwm_timer_num // 1.. index in CantonTimerHandles
        = (default) 1
        = (main:*) table(vpin_main,tim);

    const uint32_t ch0
        = (default) TIM_CHANNEL_1
        = (main:*) table(vpin_main, ch0);

    const uint32_t ch1
        = (default) TIM_CHANNEL_1
        = (main:*) table(vpin_main, ch1);

    const uint8_t notif_bemf:1
        = (all) 0;

    user uint8_t reverse_bemf:1
		= (default) 1;

} num = (main) 6
      = (simu) 6
      = (dispatcher) 1
      = (default) 0;

table vpin_main 
	( p0,    b0,   	            p1,    b1,  	    p2,    b2,			    tim, ch0, ch1)
    ( GPIOD, GPIO_PIN_0,		GPIOD, GPIO_PIN_1,	GPIOD, GPIO_PIN_2,		1, TIM_CHANNEL_1, TIM_CHANNEL_2)    // 0
    ( GPIOD, GPIO_PIN_3,		GPIOD, GPIO_PIN_4,	GPIOD, GPIO_PIN_5,		1, TIM_CHANNEL_3, TIM_CHANNEL_4)    // 1
    ( GPIOD, GPIO_PIN_6,		GPIOD, GPIO_PIN_7,	GPIOD, GPIO_PIN_8,		2, TIM_CHANNEL_3, TIM_CHANNEL_4)    // 2
    ( GPIOD, GPIO_PIN_9,		GPIOD, GPIO_PIN_10,	GPIOD, GPIO_PIN_11,		3, TIM_CHANNEL_1, TIM_CHANNEL_2)    // 3
    ( GPIOE, GPIO_PIN_2,		GPIOE, GPIO_PIN_3,	GPIOE, GPIO_PIN_5,		3, TIM_CHANNEL_3, TIM_CHANNEL_4)    // 4
    ( NULL, GPIO_PIN_0,         NULL, GPIO_PIN_0,   NULL, GPIO_PIN_0,       0, 0, 0)
;


attrib canton h_code {


#ifndef TRAIN_SIMU
#ifdef STM32_F4
#include "stm32f4xx_hal.h"
#else
#include "stm32f1xx_hal.h"
#endif
#else
typedef void *GPIO_TypeDef;
#endif

}

